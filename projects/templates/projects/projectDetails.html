{%extends 'base.html'%} {%block body%}

{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div{% if message.tags %} class="{{ message.tags }} alert alert-danger"{% endif %}>{{ message }}</div>
    {% endfor %}
</div>
{% endif %}

<div class="container bg-dark text-light rounded shadow shadow-lg my-3 p-3">
  <div class='d-flex justify-content-between'>
    <p>Project Title: {{ currentProject.title }}</p>
    <div>
  <a href='{%url "reportProject" id=currentProject.id%}'><button class='btn btn-danger'>Report Project</button></a>
  <a href='{%url "deleteProject" id=currentProject.id%}'><button class='btn btn-danger'>Delete Project</button></a></div>
</div>
  <p>Project Details: {{ currentProject.details }}</p>
  <p>Total target: {{ currentProject.target }}</p>
  <p>Start Time: {{ currentProject.start_time }}</p>
  <p>End Time: {{ currentProject.end_time }}</p>
  <p>Donations:     
    {% for donation in currentProject.donations.all %}
        <p>User: {{ donation.user.user.username }} Donated, Amount: {{ donation.donation }}</p>
    {% endfor %}
    </p>

  <h3>Ratings:</h3>
  {% for rating in currentProject.ratings.all %}
  <p>{{ rating.user.user.username }} || {{ rating.rating }}</p>
    {% endfor %}
<p>Average Rating: {{ averageRating }}</p>


  <h3>Categories:</h3>
  {% for category in currentProject.category.all %}
  <p>{{ category.name }}</p>
  {% endfor %}

  <h3>Tags:</h3>
  {% for tag in currentProject.tags.all %}
  <p>{{ tag.name }}</p>
  {% endfor %}
 <h3> Rate Project </h3>
  <form method="post" class="form-group">
    {% csrf_token %}
    {{ratingForm}}
    <div class='d-flex justify-content-end me-2 '>
    <input type="submit" name="submit-rating" value="Submit Rating" class="btn btn-primary mt-2 px-3 py-2">
    </div>
  </form>

<h3 class='mt-4'> Donate Now </h3>
<form method="post" class="form-group">
    {% csrf_token %}
    {% if not currentProject.completed %}
        <input type="number" name="donation" class="form-control" min="1" required>
        <div class='d-flex justify-content-end me-2 '>
          <input type="submit" name="submit-donation" value="Donate" class="btn btn-primary mt-2 px-4 py-2">
          </div>    {% else %}
        <input type="number" name="donation" class="form-control" min="1" disabled>
        <div class='d-flex justify-content-end me-2 '>
          <input type="submit" name="submit-donation" value="Donate" class="btn btn-primary mt-2 px-5 py-2">
          </div>    {% endif %}
</form>


</div>
<div class='border p-3  shadow shadow-lg rounded'>

<h2 class='mb-3'>Give us your opinion </h2>
<form method="post" class="form-group">
  {% csrf_token %}
 <textarea name="text" id="commentText" class="form-control" required></textarea>
 <div class="d-flex justify-content-end ">
  <input type="submit" name="submit-comment" value="Submit Comment" class="btn btn-primary ms-2 px-4 my-3 ">
</div></form>

{%if currentProject.comments.all %}
<div class='p-3'>
<h2>Comments </h2>
{% for comment in currentProject.comments.all %}
  <div class='form-control shadow shadow-lg pt-3 my-3'>
    <div class='d-flex justify-content-between'> 
   <p>{{ comment.user.user.username }} : </p>
  <a href='{%url "reportComment" id=currentProject.id commentID=comment.id %}'><button type'button' class='btn btn-danger'>Report Comment</button></a>
    </div>
  <p>{{ comment.text }}</p>
  </div>
  {% endfor %}
</div>
  {%endif%}
</div>

{%endblock%}